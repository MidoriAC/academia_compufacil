<div class="card">
  <div class="card-header border-0 pt-6">
    <div class="card-title">
      <h3>Certificados</h3>
    </div>
  </div>
  <div class="card-body py-4">
    <table
      class="table align-middle table-row-dashed fs-6 gy-5"
      id="kt_table_students"
    >
      <thead>
        <tr class="text-start text-muted fw-bolder fs-7 text-uppercase gs-0">
          <th class="min-w-125px">Estudiante</th>
          <th class="min-w-125px">Email</th>
          <th class="min-w-125px">Curso</th>
          <th class="min-w-125px">Estado del certificado</th>
          <th class="text-end min-w-100px">Acciones</th>
        </tr>
      </thead>
      <tbody class="text-gray-600 fw-bold">
        <ng-container *ngFor="let student of students">
          <tr *ngFor="let course of student.courses">
            <td>{{ student.name }}</td>
            <td>{{ student.email }}</td>
            <td>{{ course.course_title }}</td>
            <td>
              <span *ngIf="course.certificate_id">Certificate Issued</span>
              <span *ngIf="!course.certificate_id">No Certificate</span>
            </td>
            <td class="text-end">
              <button
                class="btn btn-sm btn-primary"
                (click)="
                  openCertificateModal(certificateModal, student, course)
                "
              >
                {{
                  course.certificate_id
                    ? "Update Certificate"
                    : "Upload Certificate"
                }}
              </button>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>

<ng-template #certificateModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      {{
        selectedCourse.certificate_id
          ? "Actualizar Certificado"
          : "Subir Certificado"
      }}
    </h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Estudiante: {{ selectedStudent?.name }}</p>
    <p>Curso: {{ selectedCourse?.course_title }}</p>
    <div class="form-group">
      <label for="certificate">Seleccionar archivo de certificado</label>
      <input
        type="file"
        class="form-control-file"
        id="certificate"
        (change)="onFileSelected($event)"
        accept=".pdf,.jpg,.jpeg,.png"
      />
    </div>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-dark"
      (click)="modal.close('Save click')"
    >
      Cancelar
    </button>
  </div>
</ng-template>
